## 3.10 Фильтрация по уникальности и группировка записей

Часто записи повторяются нам надо получить только уникальные записи или сгруппировать записи по какому-то полю

------

### Узнаем

- Как можно фильтровать получаемые с помощью SELECT-запросов записи по уникальности и группировать их как по одному так и по нескольким полям

------

### Синтаксис запроса

Есть таблица с заказами, таблица `order` и в ней заказы имеют разные статусы разные числа в поле статус id, если мы хотим получить все статусы в которых находятся наши заказы можно выполнить запрос ниже

```sql
SELECT DISTINCT `status_id`
FROM `order`
```

------

Надо вывести статусы уникальные сразу по нескольким полям, например с уникальными парами каких то значений

В качестве примера разберем таблицу `order_status_change` в которой сохраняются изменения статусов каждого заказа, там есть два поля src_status_id и dst_status_id (исходный и следующий статусы). Если мы хотим получить все уникальные переходы между статусами заказов мы можем выполнить такой запрос

```sql
SELECT DISTINCT s1.name,s2.name
FROM `order_status_change` ch
JOIN `order_status` s1 ON s1.id = ch.src_status_id
JOIN `order_status` s2 ON s2.id = ch.dst_status_id
```

------

### Группировка результатов

```sql
SELECT `src_status_id`, `dst_status_id`
FROM `order_status_change`
GROUP BY `src_status_id`
```

------

Есть задача вывести перечень категорий с примерами товаров которых в них находятся  

```sql
SELECT `category_id`, `name`
FROM `good`
GROUP BY `category_id`
```

------

Еще один вариант задачи решаемой при помощи группировки это вывод количества тех или иных элементов 

```sql
SELECT c.name, COUNT(*) `count`
FROM `good` g
JOIN `good_category` c ON c.id = g.category_id
GROUP BY g.category_id
ORDER BY `count` ASC
```

------

Группировка по нескольким полям

```sql
SELECT *
FROM `order_status_change`
GROUP BY `src_status_id`,
`dst_status_id`
```

