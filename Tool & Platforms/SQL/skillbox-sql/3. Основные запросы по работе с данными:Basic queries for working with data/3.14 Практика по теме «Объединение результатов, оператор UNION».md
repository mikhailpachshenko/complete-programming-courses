#### 3.14 Практика по теме «Объединение результатов, оператор UNION»



### Описание

В этом курсе мы предусмотрели опциональные мини-задания для самостоятельной практики. Их не нужно сдавать на проверку. Нажав на кнопку внизу страницы, вы найдёте алгоритм и советы по выполнению этого задания с перечнем использованных команд. Постарайтесь решить задание самостоятельно, но если возникнет вопрос, то вы всегда сможете посмотреть в эту подсказку.

В предыдущем видео вы узнали про объединение вывода нескольких SQL-запросов в один большой. Это бывает полезно, когда в разных местах (таблицах, базах данных) у вас хранятся одинаковые по структуре, но разные по смыслу таблицы.

В этом задании вам необходимо выполнить один комплексный SQL-запрос к базе данных shop.sql.

Выведите имена и email тех пользователей, которые:

- или заказывали продукты, название которых начинается с «Гватемала»;
- или имеют почтовый домен верхнего уровня gov и при этом оплатили заказ;
- или заказывали товары из категории «Кофе без кофеина».

### Эталонное решение

**Комментарий**: сначала попробуйте выполнить каждый из запросов по отдельности. Обратите внимание, что в итоговом запросе получается меньше записей. Это связано с тем, что UNION убирает дубликаты. Если вы замените его на UNION ALL, то получите все строки.

Результат запроса:

![img](https://api.selcdn.ru/v1/SEL_72086/prodLMS/files/share/3.13.1.png)

Запрос:

```sql
SELECT

    u.`name`,
    u.`email`
FROM `good` g
JOIN `order2good` o2g ON o2g.good_id = g.id
JOIN `order` o ON o.id = o2g.order_id
JOIN `user` u ON u.id = o.user_id
WHERE g.`name` LIKE 'Гватемала%'

UNION

SELECT
    u.`name`,
    u.`email`
FROM `user` u
JOIN `order` o ON
    o.user_id = u.id AND o.status_id = 7
WHERE
    u.`email` LIKE '%gov' 

UNION

SELECT
    u.`name`,
    u.`email`
FROM `user` u
JOIN `order` o ON o.user_id = u.id
JOIN `order2good` o2g ON o2g.order_id = o.id
JOIN `good` g ON g.id = o2g.good_id
JOIN `good_category` gc ON gc.id = g.category_id AND gc.name = 'Кофе без кофеина';
```